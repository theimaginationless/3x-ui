{{define "component/themeSwitchTemplate"}}
<template>
</template>
{{end}}

{{define "component/themeSwitchTemplateLogin"}}
<template>
</template>
{{end}}

{{define "component/themeSwitcher"}}
<script>
  function createThemeSwitcher() {
    const isDarkTheme = localStorage.getItem('dark-mode') === 'true';
    const isUltra = localStorage.getItem('isUltraDarkThemeEnabled') === 'true';
    document.documentElement.setAttribute('data-theme', 'ultra-dark');
    theme = "light";
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
	    theme = "dark";
	  }
    document.querySelector('body').setAttribute('class', theme);
    return {
      animationsOff() {
        document.documentElement.setAttribute('data-theme-animations', 'off');
        const themeAnimations = document.querySelector('#change-theme');
        themeAnimations.addEventListener('mouseleave', () => {
          document.documentElement.removeAttribute('data-theme-animations');
        });
        themeAnimations.addEventListener('touchend', () => {
          document.documentElement.removeAttribute('data-theme-animations');
        });
      },
      animationsOffUltra() {
        document.documentElement.setAttribute('data-theme-animations', 'off');
        const themeAnimationsUltra = document.querySelector('#change-theme-ultra');
        themeAnimationsUltra.addEventListener('mouseleave', () => {
          document.documentElement.removeAttribute('data-theme-animations');
        });
        themeAnimationsUltra.addEventListener('touchend', () => {
          document.documentElement.removeAttribute('data-theme-animations');
        });
      },
      isDarkTheme,
      isUltra,
      get currentTheme() {
		  if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
		    theme = "dark";
		  } else {
			  theme = "light";
		  }
        return theme;
      },
      toggleTheme(theme) {
        this.isDarkTheme = theme === 'dark' ? 'true' : 'false';
        localStorage.setItem('dark-mode', this.isDarkTheme);
        document.querySelector('body').setAttribute('class', theme);
        document.getElementById('message').className = themeSwitcher.currentTheme;
      },
      toggleUltra() {
        this.isUltra = !this.isUltra;
        if (this.isUltra) {
          document.documentElement.setAttribute('data-theme', 'ultra-dark');
        } else {
          document.documentElement.removeAttribute('data-theme');
        }
        localStorage.setItem('isUltraDarkThemeEnabled', this.isUltra.toString());
      }
    };
  }
  const themeSwitcher = createThemeSwitcher();
  Vue.component('theme-switch', {
    props: [],
    template: `{{template "component/themeSwitchTemplate"}}`,
    data: () => ({
      themeSwitcher
    }),
    mounted() {
      this.$message.config({
        getContainer: () => document.getElementById('message')
      });
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
  	    const theme = e.matches ? "dark" : "light";
        themeSwitcher.toggleTheme(theme);
  	  });
      document.getElementById('message').className = themeSwitcher.currentTheme;
    }
  });
  Vue.component('theme-switch-login', {
    props: [],
    template: `{{template "component/themeSwitchTemplateLogin"}}`,
    data: () => ({
      themeSwitcher
    }),
    mounted() {
      this.$message.config({
        getContainer: () => document.getElementById('message')
      });
  	  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
  	    const theme = e.matches ? "dark" : "light";
        themeSwitcher.toggleTheme(theme);
  	  });
      document.getElementById('message').className = themeSwitcher.currentTheme;
    }
  });
</script>
{{end}}
